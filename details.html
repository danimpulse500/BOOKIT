<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Book-It | Premium Lodge & Hostel Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* DETAILS PAGE - PREMIUM DESIGN */
    :root {
      --primary-color: #0a7cff;
      --primary-dark: #0056cc;
      --secondary-color: #1a1a1a;
      --accent-color: #ff6b35;
      --light-gray: #f8f9fa;
      --medium-gray: #e9ecef;
      --dark-gray: #6c757d;
      --text-color: #333333;
      --border-radius: 12px;
      --box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }

    .details-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
      font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
    }

    /* Loading and Error States */
    .loading-state {
      text-align: center;
      padding: 80px 20px;
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      margin: 20px 0;
    }

    .loading-spinner {
      border: 4px solid var(--medium-gray);
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .error-state {
      text-align: center;
      padding: 60px 40px;
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      margin: 20px 0;
    }

    .error-state h3 {
      color: #dc3545;
      margin-bottom: 15px;
      font-size: 24px;
    }

    .error-state p {
      color: var(--dark-gray);
      margin-bottom: 20px;
    }

    .error-state a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 600;
      transition: var(--transition);
    }

    .error-state a:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }

    /* Property Header */
    .property-header {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 30px;
      margin-bottom: 30px;
      position: relative;
    }

    .property-title-section {
      margin-bottom: 25px;
      padding-bottom: 25px;
      border-bottom: 1px solid var(--medium-gray);
    }

    .property-title {
      font-size: 36px;
      font-weight: 700;
      color: var(--secondary-color);
      margin-bottom: 10px;
      line-height: 1.2;
    }

    .property-location {
      display: flex;
      align-items: center;
      color: var(--dark-gray);
      font-size: 18px;
      margin-bottom: 15px;
    }

    .property-location i {
      margin-right: 8px;
      color: var(--primary-color);
    }

    .property-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }

    .meta-item {
      display: flex;
      align-items: center;
      color: var(--text-color);
      font-weight: 500;
    }

    .meta-item i {
      color: var(--primary-color);
      margin-right: 8px;
      font-size: 18px;
    }

    .badge {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin-left: 15px;
    }

    .badge-primary {
      background: rgba(10, 124, 255, 0.1);
      color: var(--primary-color);
    }

    .badge-success {
      background: rgba(40, 167, 69, 0.1);
      color: #28a745;
    }

    .badge-warning {
      background: rgba(255, 193, 7, 0.1);
      color: #ffc107;
    }

    /* Gallery Section */
    .gallery-section {
      margin-bottom: 30px;
    }

    .main-image {
      width: 100%;
      height: 500px;
      object-fit: cover;
      border-radius: var(--border-radius);
      margin-bottom: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .thumbnail-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
    }

    .thumbnail {
      width: 100%;
      height: 90px;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      border: 2px solid transparent;
    }

    .thumbnail:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border-color: var(--primary-color);
    }

    .thumbnail.active {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(10, 124, 255, 0.3);
    }

    /* Content Layout */
    .content-layout {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
    }

    @media (max-width: 992px) {
      .content-layout {
        grid-template-columns: 1fr;
      }
    }

    /* Property Details Card */
    .details-card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 30px;
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--secondary-color);
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--medium-gray);
      position: relative;
    }

    .section-title:after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 60px;
      height: 2px;
      background: var(--primary-color);
    }

    .description-text {
      color: var(--text-color);
      line-height: 1.7;
      font-size: 16px;
      margin-bottom: 25px;
    }

    /* Info Grid */
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }

    .info-card {
      background: var(--light-gray);
      border-radius: var(--border-radius);
      padding: 20px;
      text-align: center;
      transition: var(--transition);
      border: 1px solid transparent;
    }

    .info-card:hover {
      border-color: var(--primary-color);
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .info-icon {
      font-size: 32px;
      color: var(--primary-color);
      margin-bottom: 15px;
    }

    .info-label {
      display: block;
      font-size: 14px;
      color: var(--dark-gray);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .info-value {
      display: block;
      font-size: 24px;
      font-weight: 700;
      color: var(--secondary-color);
    }

    .info-value.price {
      color: var(--accent-color);
      font-size: 28px;
    }

    /* Amenities Grid */
    .amenities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .amenity-item {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      background: var(--light-gray);
      border-radius: 8px;
      transition: var(--transition);
    }

    .amenity-item:hover {
      background: rgba(10, 124, 255, 0.1);
      transform: translateX(5px);
    }

    .amenity-icon {
      width: 24px;
      height: 24px;
      background: var(--primary-color);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      font-size: 12px;
    }

    /* Rules Section */
    .rules-list {
      list-style: none;
      padding: 0;
    }

    .rules-list li {
      padding: 10px 0;
      border-bottom: 1px solid var(--medium-gray);
      color: var(--text-color);
      display: flex;
      align-items: flex-start;
    }

    .rules-list li:last-child {
      border-bottom: none;
    }

    .rules-list i {
      color: var(--primary-color);
      margin-right: 10px;
      margin-top: 3px;
    }

    /* Video Section */
    .video-container {
      position: relative;
      width: 100%;
      padding-top: 56.25%;
      background: var(--secondary-color);
      border-radius: var(--border-radius);
      overflow: hidden;
      margin: 20px 0;
    }

    .video-container video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .video-placeholder {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      background: rgba(0, 0, 0, 0.7);
    }

    .video-placeholder i {
      font-size: 48px;
      margin-bottom: 15px;
      color: var(--primary-color);
    }

    /* Sidebar */
    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    /* Agent Card */
    .agent-card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 30px;
      text-align: center;
    }

    .agent-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 20px;
      border: 4px solid var(--primary-color);
      padding: 3px;
    }

    .agent-name {
      font-size: 22px;
      font-weight: 700;
      color: var(--secondary-color);
      margin-bottom: 5px;
    }

    .agent-title {
      color: var(--dark-gray);
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 20px;
    }

    .agent-contact {
      margin: 20px 0;
    }

    .contact-item {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px 0;
      color: var(--text-color);
    }

    .contact-item i {
      color: var(--primary-color);
      margin-right: 10px;
      width: 20px;
    }

    /* Action Card */
    .action-card {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 30px;
      color: white;
      text-align: center;
    }

    .action-icon {
      font-size: 48px;
      margin-bottom: 20px;
      opacity: 0.9;
    }

    .action-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 15px;
    }

    .action-description {
      opacity: 0.9;
      margin-bottom: 25px;
      line-height: 1.6;
    }

    .whatsapp-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      background: #25D366;
      color: white;
      font-weight: 600;
      padding: 16px 30px;
      border-radius: 50px;
      text-decoration: none;
      transition: var(--transition);
      font-size: 16px;
      margin-top: 15px;
      box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
    }

    .whatsapp-btn:hover {
      background: #128C7E;
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(37, 211, 102, 0.4);
    }

    .whatsapp-btn i {
      margin-right: 10px;
      font-size: 20px;
    }

    .call-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      background: white;
      color: var(--primary-color);
      font-weight: 600;
      padding: 16px 30px;
      border-radius: 50px;
      text-decoration: none;
      transition: var(--transition);
      font-size: 16px;
      margin-top: 15px;
      border: 2px solid var(--primary-color);
    }

    .call-btn:hover {
      background: var(--primary-color);
      color: white;
      transform: translateY(-3px);
    }

    .call-btn i {
      margin-right: 10px;
    }

    /* Property Status */
    .property-status {
      display: inline-flex;
      align-items: center;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 14px;
      margin-left: 15px;
    }

    .status-available {
      background: rgba(40, 167, 69, 0.1);
      color: #28a745;
    }

    .status-unavailable {
      background: rgba(220, 53, 69, 0.1);
      color: #dc3545;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .details-container {
        padding: 15px;
      }

      .property-header,
      .details-card,
      .agent-card,
      .action-card {
        padding: 20px;
      }

      .property-title {
        font-size: 28px;
      }

      .main-image {
        height: 300px;
      }

      .info-grid {
        grid-template-columns: 1fr;
      }

      .amenities-grid {
        grid-template-columns: 1fr;
      }

      .property-meta {
        flex-direction: column;
        gap: 10px;
      }

      .badge {
        margin-left: 0;
        margin-top: 10px;
      }
    }

    /* Additional Details */
    .additional-details {
      background: var(--light-gray);
      border-radius: var(--border-radius);
      padding: 25px;
      margin: 25px 0;
    }

    .detail-row {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }

    .detail-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid var(--medium-gray);
    }

    .detail-item:last-child {
      border-bottom: none;
    }

    .detail-label {
      font-weight: 600;
      color: var(--text-color);
    }

    .detail-value {
      color: var(--dark-gray);
    }

    /* Map Placeholder */
    .map-placeholder {
      height: 200px;
      background: linear-gradient(45deg, var(--medium-gray), var(--light-gray));
      border-radius: var(--border-radius);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--dark-gray);
      margin: 20px 0;
    }

    .map-placeholder i {
      font-size: 40px;
      margin-right: 15px;
      color: var(--primary-color);
    }
  </style>
</head>

<body>
  <!-- Authentication Check -->
  <script>
    if (!localStorage.getItem("loggedInUser")) {
      window.location.href = "login.html";
    }
  </script>

  <!-- NAVBAR -->
  <header class="navbar">
    <a href="index.html" class="logo">
      <img src="logo.png" alt="Book-It Logo">
    </a>

    <!-- Desktop Menu -->
    <nav class="menu-panel desktop-nav" id="navMenu">
      <a href="index.html">Home</a>
      <a href="contact.html">Contact/Support</a>
      <a href="post.html" id="postLink">Post Lodge</a>
      <div class="user-area" id="userArea"></div>
    </nav>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn">☰</button>

    <!-- Mobile Menu -->
    <nav class="menu-panel mobile-nav" id="mobileNav"></nav>
  </header>

  <!-- LISTING DETAILS -->
  <main class="details-container" id="listingDetailsContainer">
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading premium property details...</p>
    </div>
  </main>

  <footer class="footer">
    <p>© 2025 Book-It. Student housing made easy.</p>
  </footer>
  <script src="js/main.js"></script>

  <script>
    // API Configuration
    const API_BASE_URL = "https://bookit-api-tpvz.onrender.com";

    // Get listing ID from URL or localStorage
    function getListingId() {
      const urlParams = new URLSearchParams(window.location.search);
      const idFromUrl = urlParams.get('id');
      const idFromStorage = localStorage.getItem("selectedListing");
      return idFromUrl || idFromStorage;
    }

    // Format price with commas
    function formatPrice(price) {
      return parseFloat(price).toLocaleString('en-NG', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    // Map amenities to icons
    const amenityIcons = {
      'WiFi': 'wifi',
      'Electricity': 'bolt',
      'Water': 'faucet',
      'Security': 'shield-alt',
      'Parking': 'parking',
      'Furnished': 'couch',
      'Kitchen': 'utensils',
      'AC': 'snowflake',
      'TV': 'tv',
      'Laundry': 'tshirt',
      'Gym': 'dumbbell',
      'Pool': 'swimming-pool'
    };

    // Fetch listing details from API
    async function fetchListingDetails(listingId) {
      try {
        const response = await fetch(`${API_BASE_URL}/api/listings/${listingId}/`, {
          method: 'GET',
          headers: { 'Accept': 'application/json' }
        });

        if (!response.ok) throw new Error(`Failed to fetch listing: ${response.status}`);
        return await response.json();
      } catch (error) {
        console.error('Error fetching listing:', error);
        throw error;
      }
    }

    // Generate WhatsApp link
    function generateWhatsAppLink(phoneNumber, listingTitle) {
      const cleanPhone = phoneNumber.replace(/\D/g, '');
      const whatsappNumber = cleanPhone.startsWith('234') ? cleanPhone : '234' + cleanPhone.slice(-10);
      const message = `Hello! I'm interested in your property: ${listingTitle}. I saw it on Book-It.`;
      const encodedMessage = encodeURIComponent(message);
      return `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
    }

    // Generate call link
    function generateCallLink(phoneNumber) {
      const cleanPhone = phoneNumber.replace(/\D/g, '');
      return `tel:+${cleanPhone}`;
    }

    // Get amenity icon
    function getAmenityIcon(amenity) {
      for (const [key, icon] of Object.entries(amenityIcons)) {
        if (amenity.toLowerCase().includes(key.toLowerCase())) {
          return icon;
        }
      }
      return 'check';
    }

    // Render listing details
    async function renderListingDetails() {
      const container = document.getElementById("listingDetailsContainer");
      const listingId = getListingId();

      if (!listingId) {
        container.innerHTML = `
          <div class="error-state">
            <h3><i class="fas fa-exclamation-triangle"></i> No Listing Selected</h3>
            <p>Please select a property from our listings page.</p>
            <a href="index.html">Browse Available Properties</a>
          </div>
        `;
        return;
      }

      try {
        const listing = await fetchListingDetails(listingId);

        // Generate contact links
        const contactPhone = listing.contact_phone || listing.agent_detail?.phone_number || '2348000000000';
        const whatsappLink = generateWhatsAppLink(contactPhone, listing.lodge_name);
        const callLink = generateCallLink(contactPhone);

        // Get primary image
        const primaryImage = listing.cover_image_url ||
          (listing.images && listing.images[0]?.image_url) ||
          'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=1200&h=800&fit=crop';

        // Process amenities
        let amenities = [];
        if (listing.amenities && listing.amenities.length > 0) {
          amenities = listing.amenities;
        } else if (listing.description) {
          const commonAmenities = Object.keys(amenityIcons);
          amenities = commonAmenities.filter(amenity =>
            listing.description.toLowerCase().includes(amenity.toLowerCase())
          );
        }

        // Render premium template
        container.innerHTML = `
          <!-- Property Header -->
          <div class="property-header">
            <div class="property-title-section">
              <h1 class="property-title">${listing.lodge_name}</h1>
              <div class="property-location">
                <i class="fas fa-map-marker-alt"></i>
                ${listing.location_detail?.name || listing.location}
              </div>
              <div class="property-meta">
                <span class="meta-item">
                  <i class="fas fa-home"></i>
                  ${listing.room_type?.replace('_', ' ') || 'Property'}
                </span>
                <span class="meta-item">
                  <i class="fas fa-calendar-alt"></i>
                  Posted: ${new Date(listing.created_at).toLocaleDateString('en-NG', {
          year: 'numeric',
          month: 'short',
          day: 'numeric'
        })}
                </span>
                <span class="property-status ${listing.is_available ? 'status-available' : 'status-unavailable'}">
                  <i class="fas ${listing.is_available ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                  ${listing.is_available ? 'Available Now' : 'Currently Unavailable'}
                </span>
              </div>
            </div>

            <!-- Gallery -->
            <div class="gallery-section">
              <img src="${primaryImage}" alt="${listing.lodge_name}" class="main-image" id="mainImage">
              ${listing.images && listing.images.length > 1 ? `
                <div class="thumbnail-grid">
                  ${listing.images.slice(0, 6).map((img, index) => `
                    <img src="${img.image_url}" 
                         alt="Property image ${index + 1}" 
                         class="thumbnail ${index === 0 ? 'active' : ''}"
                         onclick="changeMainImage('${img.image_url}', this)">
                  `).join('')}
                </div>
              ` : ''}
            </div>
          </div>

          <!-- Main Content -->
          <div class="content-layout">
            <!-- Left Column - Property Details -->
            <div class="left-column">
              <!-- Description -->
              <div class="details-card">
                <h2 class="section-title">Description</h2>
                <p class="description-text">${listing.description || 'No description provided.'}</p>
              </div>

              <!-- Property Information -->
              <div class="details-card">
                <h2 class="section-title">Property Information</h2>
                <div class="info-grid">
                  <div class="info-card">
                    <div class="info-icon"><i class="fas fa-tag"></i></div>
                    <span class="info-label">Price</span>
                    <span class="info-value price">₦${formatPrice(listing.price)}</span>
                    <small class="info-label">per annum</small>
                  </div>
                  
                  ${listing.total_rooms ? `
                  <div class="info-card">
                    <div class="info-icon"><i class="fas fa-door-closed"></i></div>
                    <span class="info-label">Total Rooms</span>
                    <span class="info-value">${listing.total_rooms}</span>
                  </div>` : ''}
                  
                  ${listing.room_number ? `
                  <div class="info-card">
                    <div class="info-icon"><i class="fas fa-hashtag"></i></div>
                    <span class="info-label">Room Number</span>
                    <span class="info-value">${listing.room_number}</span>
                  </div>` : ''}
                  
                  <div class="info-card">
                    <div class="info-icon"><i class="fas fa-building"></i></div>
                    <span class="info-label">Property Type</span>
                    <span class="info-value">${listing.room_type?.replace('_', ' ') || 'Lodge'}</span>
                  </div>
                </div>

                <!-- Additional Details -->
                <div class="additional-details">
                  <div class="detail-row">
                    ${listing.old_location ? `
                    <div class="detail-item">
                      <span class="detail-label">Previous Location:</span>
                      <span class="detail-value">${listing.old_location}</span>
                    </div>` : ''}
                    
                    ${listing.agency ? `
                    <div class="detail-item">
                      <span class="detail-label">Agency:</span>
                      <span class="detail-value">${listing.agency}</span>
                    </div>` : ''}
                    
                    <div class="detail-item">
                      <span class="detail-label">Last Updated:</span>
                      <span class="detail-value">
                        ${new Date(listing.updated_at).toLocaleDateString('en-NG', {
          year: 'numeric',
          month: 'short',
          day: 'numeric'
        })}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Amenities -->
              ${amenities.length > 0 ? `
              <div class="details-card">
                <h2 class="section-title">Amenities & Features</h2>
                <div class="amenities-grid">
                  ${amenities.map(amenity => `
                    <div class="amenity-item">
                      <div class="amenity-icon">
                        <i class="fas fa-${getAmenityIcon(amenity)}"></i>
                      </div>
                      <span>${amenity}</span>
                    </div>
                  `).join('')}
                </div>
              </div>
              ` : ''}

              <!-- Rules -->
              ${listing.rules ? `
              <div class="details-card">
                <h2 class="section-title">House Rules</h2>
                <ul class="rules-list">
                  ${listing.rules.split('.').filter(rule => rule.trim()).map(rule => `
                    <li><i class="fas fa-check-circle"></i> ${rule.trim()}</li>
                  `).join('')}
                </ul>
              </div>
              ` : ''}

              <!-- Video -->
              ${listing.video_url ? `
              <div class="details-card">
                <h2 class="section-title">Property Video</h2>
                <div class="video-container">
                  <video controls poster="${primaryImage}">
                    <source src="${listing.video_url}" type="video/mp4">
                    Your browser does not support the video tag.
                  </video>
                </div>
              </div>
              ` : ''}

              <!-- Location Map -->
              <div class="details-card">
                <h2 class="section-title">Location</h2>
                <div class="map-placeholder">
                  <i class="fas fa-map-marked-alt"></i>
                  <div>
                    <p><strong>${listing.location_detail?.name || listing.location}</strong></p>
                    <p>${listing.location_detail?.description || 'Location details available upon booking'}</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Right Column - Sidebar -->
            <div class="sidebar">
              <!-- Agent Card -->
              <div class="agent-card">
                <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(listing.agent_detail?.full_name || 'Agent')}&background=0a7cff&color=fff&size=100" 
                     alt="${listing.agent_detail?.full_name || 'Agent'}" 
                     class="agent-avatar">
                <h3 class="agent-name">${listing.agent_detail?.full_name || 'Property Agent'}</h3>
                <p class="agent-title">${listing.agent_detail?.is_agent ? 'Certified Agent' : 'Property Manager'}</p>
                
                <div class="agent-contact">
                  ${listing.agent_detail?.email ? `
                    <div class="contact-item">
                      <i class="fas fa-envelope"></i>
                      <span>${listing.agent_detail.email}</span>
                    </div>
                  ` : ''}
                  
                  ${listing.agent_detail?.phone_number ? `
                    <div class="contact-item">
                      <i class="fas fa-phone"></i>
                      <span>${listing.agent_detail.phone_number}</span>
                    </div>
                  ` : ''}
                  
                  ${listing.agent_detail?.agency_name ? `
                    <div class="contact-item">
                      <i class="fas fa-building"></i>
                      <span>${listing.agent_detail.agency_name}</span>
                    </div>
                  ` : ''}
                </div>
              </div>

              <!-- Action Card -->
              <div class="action-card">
                <div class="action-icon">
                  <i class="fas fa-calendar-check"></i>
                </div>
                <h3 class="action-title">Ready to Book?</h3>
                <p class="action-description">
                  Contact the agent directly for viewing appointments, 
                  pricing details, and availability confirmation.
                </p>
                
                <a href="${whatsappLink}" target="_blank" class="whatsapp-btn">
                  <i class="fab fa-whatsapp"></i> WhatsApp Agent
                </a>
                
                <a href="${callLink}" class="call-btn">
                  <i class="fas fa-phone"></i> Call Agent
                </a>
                
                ${listing.contact_email ? `
                  <a href="mailto:${listing.contact_email}" class="call-btn" style="margin-top: 10px;">
                    <i class="fas fa-envelope"></i> Email Agent
                  </a>
                ` : ''}
              </div>
            </div>
          </div>
        `;

      } catch (error) {
        console.error('Error:', error);
        container.innerHTML = `
          <div class="error-state">
            <h3><i class="fas fa-exclamation-circle"></i> Error Loading Property</h3>
            <p>We encountered an issue loading the property details. Please try again later.</p>
            <p><small>Error: ${error.message}</small></p>
            <a href="index.html">Return to Homepage</a>
          </div>
        `;
      }
    }

    // Change main image function
    function changeMainImage(imageUrl, element) {
      const mainImage = document.getElementById('mainImage');
      if (mainImage) {
        mainImage.src = imageUrl;
      }

      // Update active thumbnail
      document.querySelectorAll('.thumbnail').forEach(thumb => {
        thumb.classList.remove('active');
      });
      element.classList.add('active');
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', renderListingDetails);
  </script>
</body>

</html>