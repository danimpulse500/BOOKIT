<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Book-It | Find Hostels & Lodges</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

  <!-- NAVBAR -->
<header class="navbar">
  <a href="index.html" class="logo">
    <img src="logo.png" alt="Book-It Logo">
  </a>

  <!-- Desktop Menu -->
  <nav class="menu-panel desktop-nav" id="navMenu">
    <a href="index.html">Home</a>
    <a href="contact.html">Contact/Support</a>
    <a href="post.html" id="postLink">Post Lodge</a>
    <div class="user-area" id="userArea"></div>
  </nav>

  <!-- Mobile Menu Button -->
  <button class="mobile-menu-btn" id="mobileMenuBtn">☰</button>

  <!-- Mobile Menu -->
  <nav class="menu-panel mobile-nav" id="mobileNav"></nav>
</header>

  <!-- MOBILE SEARCH PILL -->
  <div class="mobile-search-pill" id="mobileSearchPill">
    <span class="search-label">Where are you staying?</span>
    <span class="search-action">Search</span>
  </div>

  <!-- MOBILE SEARCH MODAL -->
  <div class="search-modal" id="searchModal">
    <div class="search-modal-content">
      <h3>Search Hostels</h3>

      <select id="locationInputMobile" class="modern-select">
        <option value="">Select Location</option>
        <option value="Amansea">Amansea</option>
        <option value="Ifite-Up School">Ifite – Up School</option>
        <option value="Ifite-Down School">Ifite – Down School</option>
        <option value="Permanent Site">Permanent Site</option>
        <option value="Temp Site">Temp Site</option>
        <option value="Unizik Gate">Unizik Gate</option>
        <option value="Awka Road">Awka Road</option>
      </select>

      <input type="number" id="minPriceMobile" placeholder="Min ₦">
      <input type="number" id="maxPriceMobile" placeholder="Max ₦">

      <button id="mobileSearchBtn">Search</button>
      <button class="close-btn" id="closeSearchBtn">Cancel</button>
    </div>
  </div>

  <!-- HERO SECTION -->
  <section class="hero">
    <h2>Find Student-Friendly Hostels & Lodges</h2>
    <p>Search by location and budget</p>

    <!-- SEARCH BAR -->
    <div class="search-box">
      <div class="select-wrapper">
        <select id="locationInput" class="modern-select">
          <option value="">Select Location</option>
          <option value="Amansea">Amansea</option>
          <option value="Ifite-Up School">Ifite – Up School</option>
          <option value="Ifite-Down School">Ifite – Down School</option>
          <option value="Permanent Site">Permanent Site</option>
          <option value="Temp Site">Temp Site</option>
          <option value="Unizik Gate">Unizik Gate</option>
          <option value="Awka Road">Awka Road</option>
        </select>
      </div>

      <input type="number" id="minPrice" placeholder="Min ₦">
      <input type="number" id="maxPrice" placeholder="Max ₦">
      <button onclick="searchListings()">Search</button>
    </div>
  </section>

  <!-- LISTINGS -->
  <section class="listings-container" id="listingsContainer">
    <!-- Listings will be injected here -->
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <p>© 2025 Book-It. Student housing made easy.</p>
  </footer>

  <!-- API SCRIPT -->
    <script src="js/main.js"></script>

  <script>
    const API_BASE = "https://bookit-api-tpvz.onrender.com/api";

    // Helper function to fetch listings
    async function fetchListings() {
      try {
        const res = await fetch(`${API_BASE}/listings/`);
        const data = await res.json();
        return data;
      } catch (error) {
        console.error("Error fetching listings:", error);
        return [];
      }
    }

    // Render listings to the page
  // Render listings to the page - FIXED VERSION
  function renderListings(listings) {
    const container = document.getElementById("listingsContainer");
    container.innerHTML = "";

    if (listings.length === 0) {
      container.innerHTML = "<p>No listings found.</p>";
      return;
    }

    listings.forEach(listing => {
      const card = document.createElement("div");
      card.className = "listing-card";

      // Get the first image URL from the images array
      let imageUrl = 'https://via.placeholder.com/400';
      if (listing.images && listing.images.length > 0 && listing.images[0].image) {
        imageUrl = listing.images[0].image;
      } else if (listing.cover_image_url) {
        imageUrl = listing.cover_image_url; // fallback to cover image
      }

      card.innerHTML = `
      <a href="details.html?id=${listing.id}" style="text-decoration:none;color:inherit;">
          <div class="clickable-card" onclick="viewListingDetails(${listing.id})">
            <img src="${imageUrl}" alt="${listing.title}">
            <div class="card-body">
              <h5>${listing.title}</h5>
              <p>${listing.location}</p>
              <p class="price">₦${Number(listing.price).toLocaleString()}</p>
            </div>
          </div>
          <div class="card-actions">
            <button class="edit-btn" onclick="event.stopPropagation(); editListing(${listing.id})">Edit</button>
            <button class="delete-btn" onclick="event.stopPropagation(); deleteListing(${listing.id})">Delete</button>
          </div>
          </a>
        `;

      // Add this function to handle card clicks
      function viewListingDetails(listingId) {
        window.location.href = `details.html?id=${listingId}`;
      }

      container.appendChild(card);
    });
  }
    // Search/filter function
    async function searchListings() {
      const location = document.getElementById("locationInput").value.toLowerCase();
      const minPrice = Number(document.getElementById("minPrice").value) || 0;
      const maxPrice = Number(document.getElementById("maxPrice").value) || Infinity;

      const listings = await fetchListings();

      const filtered = listings.filter(l => {
        const loc = (l.location || "").toLowerCase();
        const price = Number(l.price);
        return loc.includes(location) && price >= minPrice && price <= maxPrice;
      });

      renderListings(filtered);
    }

    // Edit/Delete placeholders
    window.editListing = function (id) {
      alert("Edit listing with ID: " + id);
    }
    window.deleteListing = function (id) {
      if (confirm("Are you sure you want to delete this listing?")) {
        alert("Delete listing with ID: " + id);
      }
    }

    // MOBILE MENU & SEARCH
    const mobileMenuBtn = document.getElementById("mobileMenuBtn");
    const desktopNav = document.getElementById("navMenu");
    mobileMenuBtn.addEventListener("click", () => desktopNav.classList.toggle("active"));

    const searchModal = document.getElementById("searchModal");
    const mobileSearchPill = document.getElementById("mobileSearchPill");
    const closeSearchBtn = document.getElementById("closeSearchBtn");
    const mobileSearchBtn = document.getElementById("mobileSearchBtn");

    mobileSearchPill.addEventListener("click", () => searchModal.classList.add("active"));
    closeSearchBtn.addEventListener("click", () => searchModal.classList.remove("active"));
    mobileSearchBtn.addEventListener("click", () => {
      document.getElementById("locationInput").value = document.getElementById("locationInputMobile").value;
      document.getElementById("minPrice").value = document.getElementById("minPriceMobile").value;
      document.getElementById("maxPrice").value = document.getElementById("maxPriceMobile").value;
      searchModal.classList.remove("active");
      searchListings();
    });

    // Initial render
    searchListings();
  </script>

</body>

</html>